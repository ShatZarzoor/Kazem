<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO أساسي -->
    <title>معرض كاضم البهادلي - اكسسوارات وأجهزة كهربائية في ميسان</title>
    <meta name="description" content="معرض كاضم البهادلي في ميسان لبيع اكسسوارات الموبايل، كفرات الأجهزة الكهربائية، وأجهزة العناية بالبشرة مع خدمة طلب وتوصيل داخل العراق.">
    <meta name="keywords" content="معرض كاضم البهادلي, معرض كاضم البهادلي في ميسان, اكسسوارات الموبايل في ميسان, أجهزة كهربائية في ميسان, متجر ميسان, كفرات الأجهزة الكهربائية, عناية البشرة">
    <meta name="robots" content="index,follow">

    <!-- Open Graph (مفيدة لو شاركت الرابط) -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="معرض كاضم البهادلي - اكسسوارات وأجهزة كهربائية في ميسان">
    <meta property="og:description" content="تسوق من معرض كاضم البهادلي في ميسان: اكسسوارات موبايل، أجهزة كهربائية، وأجهزة عناية بالبشرة مع خدمة الطلب والتوصيل.">
    <meta property="og:locale" content="ar_AR">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #e74c3c;
            --accent: #3498db;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
        }

        body {
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header */
        header {
            background-color: var(--primary);
            color: white;
            padding: 15px 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 28px;
            color: var(--accent);
        }

        .logo h1 {
            font-size: 24px;
            font-weight: 700;
        }

        .logo span {
            color: var(--accent);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 18px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }

        nav a:hover {
            color: var(--accent);
        }

        .cart-icon {
            position: relative;
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .admin-link {
            background-color: var(--accent);
            padding: 5px 12px;
            border-radius: var(--border-radius);
        }

        /* Hero */
        .hero {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1556656793-08538906a9f8?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            text-align: center;
            padding: 80px 20px;
            margin-bottom: 40px;
        }

        .hero h2 {
            font-size: 32px;
            margin-bottom: 15px;
        }

        .hero p {
            font-size: 17px;
            max-width: 700px;
            margin: 0 auto 25px;
        }

        /* SEO – قسم تعريف عن المعرض داخل الصفحة الرئيسية */
        .about-section {
            background-color: #ffffff;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px 20px;
            margin: -20px auto 40px;
        }

        .about-section h2 {
            font-size: 22px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .about-section h3 {
            font-size: 18px;
            color: var(--accent);
            margin: 10px 0;
        }

        .about-section p {
            margin-bottom: 10px;
        }

        .about-section ul {
            list-style: disc;
            padding-right: 20px;
            margin-top: 5px;
        }

        /* Products */
        .section-title {
            text-align: center;
            margin-bottom: 40px;
            color: var(--primary);
            position: relative;
            padding-bottom: 15px;
        }

        .section-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background-color: var(--accent);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 50px;
        }

        @media (min-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (min-width: 992px) {
            .products-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        .product-card {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-image {
            width: 100%;
            height: 0;
            padding-bottom: 100%;
            background-color: #f5f5f5;
            position: relative;
            overflow: hidden;
        }

        .product-image img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-info {
            padding: 15px;
        }

        .product-title {
            font-weight: 600;
            margin-bottom: 8px;
            height: 40px;
            overflow: hidden;
        }

        .product-price {
            color: var(--secondary);
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            flex: 1;
        }

        .btn-preview {
            background-color: var(--primary);
            color: white;
        }

        .btn-preview:hover {
            background-color: #1a252f;
        }

        .btn-cart {
            background-color: var(--accent);
            color: white;
        }

        .btn-cart:hover {
            background-color: #2980b9;
        }

        /* Product Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            width: 95%;
            max-width: 900px;
            margin: 30px auto;
            border-radius: var(--border-radius);
            overflow: hidden;
            animation: modalFade 0.3s;
        }

        @keyframes modalFade {
            from {opacity: 0; transform: translateY(-30px);}
            to {opacity: 1; transform: translateY(0);}
        }

        .modal-header {
            padding: 20px;
            background-color: var(--primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        .product-media {
            margin-bottom: 20px;
        }

        .product-video {
            width: 100%;
            height: 400px;
            background-color: #000;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .product-video iframe, .product-video video {
            width: 100%;
            height: 100%;
            border: none;
        }

        .product-images {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        @media (min-width: 768px) {
            .product-images {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .product-images img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .product-images img:hover {
            transform: scale(1.05);
        }

        .product-description {
            margin-bottom: 25px;
            line-height: 1.8;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
        }

        .modal-actions .btn {
            padding: 12px 20px;
            font-size: 16px;
        }

        /* Cart */
        .cart-page, .checkout-page {
            padding: 40px 0;
            min-height: 70vh;
        }

        .cart-items {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-left: 15px;
        }

        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .cart-item-price {
            color: var(--secondary);
            font-weight: 700;
        }

        .remove-item {
            background-color: transparent;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 18px;
            transition: color 0.3s;
        }

        .remove-item:hover {
            color: var(--secondary);
        }

        .cart-summary {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .total-row {
            font-weight: 700;
            font-size: 18px;
            border-bottom: none;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid var(--primary);
        }

        .btn-checkout {
            background-color: var(--secondary);
            color: white;
            width: 100%;
            padding: 15px;
            font-size: 18px;
            margin-top: 20px;
        }

        .btn-checkout:hover {
            background-color: #c0392b;
        }

        /* Checkout */
        .checkout-form {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            max-width: 700px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: border 0.3s;
        }

        .form-control:focus {
            border-color: var(--accent);
            outline: none;
        }

        .optional {
            color: var(--gray);
            font-weight: normal;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-submit {
            background-color: var(--primary);
            color: white;
            flex: 2;
        }

        .btn-back {
            background-color: var(--gray);
            color: white;
            flex: 1;
        }

        .btn-submit:hover {
            background-color: #1a252f;
        }

        .btn-back:hover {
            background-color: #7f8c8d;
        }

        /* Footer */
        footer {
            background-color: var(--primary);
            color: white;
            padding: 40px 0 20px;
            margin-top: 60px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 30px;
        }

        @media (min-width: 768px) {
            .footer-content {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .footer-section h3 {
            margin-bottom: 20px;
            color: var(--accent);
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 10px;
        }

        .footer-section a {
            color: #ddd;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-section a:hover {
            color: var(--accent);
        }

        .copyright {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #aaa;
            font-size: 14px;
        }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            font-size: 18px;
            color: var(--gray);
        }

        .loading i {
            margin-left: 10px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Categories */
        .categories-filter {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 8px 20px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s;
        }

        .category-btn.active {
            background-color: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .category-btn:hover:not(.active) {
            background-color: #f5f5f5;
        }

        /* Empty States */
        .empty-cart {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-cart i {
            font-size: 80px;
            color: var(--gray);
            margin-bottom: 20px;
        }

        .empty-cart p {
            font-size: 18px;
            margin-bottom: 30px;
        }

        /* Success Message */
        .success-message {
            display: none;
            background-color: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            text-align: center;
        }

        .success-message i {
            font-size: 40px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-store"></i>
                <h1>معرض <span>كاضم البهادلي</span></h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#"><i class="fas fa-home"></i> الرئيسية</a></li>
                    <li><a href="#about"><i class="fas fa-info-circle"></i> عن المعرض</a></li>
                    <li><a href="#" class="category-filter" data-category="موبايل"><i class="fas fa-mobile-alt"></i> اكسسوارات الموبايل</a></li>
                    <li><a href="#" class="category-filter" data-category="أجهزة كهربائية"><i class="fas fa-plug"></i> أجهزة كهربائية</a></li>
                    <li><a href="#" class="category-filter" data-category="عناية البشرة"><i class="fas fa-spa"></i> عناية البشرة</a></li>
                    <li>
                        <a href="#" class="cart-icon" id="cartLink">
                            <i class="fas fa-shopping-cart"></i> السلة
                            <span class="cart-count" id="cartCount">0</span>
                        </a>
                    </li>
                    <li><a href="admin.html" class="admin-link"><i class="fas fa-cog"></i> لوحة التحكم</a></li>
                    <li><a href="about.html"><i class="fas fa-book"></i> معلومات المعرض</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero -->
    <section class="hero">
        <div class="container">
            <h2>أحدث اكسسوارات الموبايل والأجهزة الكهربائية في ميسان</h2>
            <p>اكتشف مجموعتنا الواسعة من اكسسوارات الموبايل، كفرات الأجهزة الكهربائية، وأجهزة العناية بالبشرة بأفضل الأسعار من معرض كاضم البهادلي في ميسان مع خدمة طلب وتوصيل.</p>
        </div>
    </section>

    <!-- قسم تعريفي داخل الصفحة (SEO داخلي) -->
    <section class="container about-section" id="about">
        <h2>عن معرض كاضم البهادلي في ميسان</h2>
        <p>
            معرض كاضم البهادلي هو معرض متخصص في بيع اكسسوارات الموبايل، كفرات الأجهزة الكهربائية،
            وأجهزة العناية بالبشرة، ويخدم أهالي <strong>ميسان</strong> والمناطق القريبة منها مع إمكانية
            تجهيز الطلبات لأكثر من محافظة داخل العراق حسب الاتفاق.
        </p>
        <h3>ماذا تجد لدينا؟</h3>
        <ul>
            <li>اكسسوارات موبايل حديثة (شواحن، سماعات، كفرات حماية، حوامل، وغيرها).</li>
            <li>أجهزة كهربائية منزلية عملية وأساسية لكل بيت.</li>
            <li>أجهزة عناية بالبشرة والشعر للاستخدام المنزلي.</li>
        </ul>
        <h3>مميزات الشراء من معرض كاضم البهادلي</h3>
        <ul>
            <li>أسعار مناسبة ومنافسة مع عروض مستمرة.</li>
            <li>إمكانية مشاهدة صور المنتج وتفاصيله من خلال المتجر الإلكتروني.</li>
            <li>طلب سريع عبر المتجر مع استلام بياناتك والتواصل لتأكيد الطلب.</li>
        </ul>
        <p>
            يمكنك استخدام هذا المتجر الإلكتروني لاختيار المنتج، إضافته إلى السلة، وإرسال طلبك،
            ليتم التواصل معك من قبل إدارة معرض كاضم البهادلي لتأكيد الطلب وتحديد طريقة التوصيل
            داخل ميسان أو للمحافظات الأخرى.
        </p>
        <p>
            للمزيد من المعلومات عن المعرض وطريقة الطلب من داخل وخارج ميسان، يمكنك زيارة صفحة
            <a href="about.html">معلومات معرض كاضم البهادلي في ميسان</a>.
        </p>
    </section>

    <!-- Products -->
    <section class="container">
        <h2 class="section-title">منتجاتنا المميزة</h2>

        <div class="categories-filter">
            <button class="category-btn active" data-category="all">الكل</button>
            <button class="category-btn" data-category="موبايل">اكسسوارات الموبايل</button>
            <button class="category-btn" data-category="أجهزة كهربائية">أجهزة كهربائية</button>
            <button class="category-btn" data-category="عناية البشرة">عناية البشرة</button>
        </div>

        <div class="products-grid" id="productsGrid">
            <div class="loading">
                <i class="fas fa-spinner"></i> جاري تحميل المنتجات...
            </div>
        </div>
    </section>

    <!-- Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalProductTitle">تفاصيل المنتج</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="product-media">
                    <div class="product-video" id="productVideoContainer">
                        <!-- الفيديو سيتم إضافته -->
                    </div>
                    <div class="product-images" id="productImages">
                        <!-- الصور ستتم إضافتها -->
                    </div>
                </div>
                <div class="product-description" id="productDescription">
                    <!-- الوصف سيتم إضافته -->
                </div>
                <div class="modal-actions">
                    <button class="btn btn-cart" id="modalAddToCart">
                        <i class="fas fa-cart-plus"></i> إضافة إلى السلة
                    </button>
                    <div class="product-price" id="modalProductPrice"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart -->
    <section class="cart-page container" id="cartPage" style="display:none;">
        <h2 class="section-title">سلة المشتريات</h2>

        <div class="cart-items" id="cartItemsContainer">
            <!-- عناصر السلة -->
        </div>

        <div class="cart-summary">
            <div class="summary-row">
                <span>المجموع الجزئي:</span>
                <span id="subtotal">0 دينار</span>
            </div>
            <div class="summary-row">
                <span>سعر التوصيل:</span>
                <span>2,000 دينار</span>
            </div>
            <div class="summary-row total-row">
                <span>المجموع الكلي:</span>
                <span id="total">2,000 دينار</span>
            </div>

            <button class="btn btn-checkout" id="checkoutBtn">
                <i class="fas fa-paper-plane"></i> تأكيد الطلب
            </button>
        </div>
    </section>

    <!-- Checkout -->
    <section class="checkout-page container" id="checkoutPage" style="display:none;">
        <h2 class="section-title">تأكيد الطلب</h2>

        <div class="success-message" id="successMessage">
            <i class="fas fa-check-circle"></i>
            <h3>تم إرسال طلبك بنجاح!</h3>
            <p>سيتم التواصل معك في أقرب وقت لتأكيد الطلب وتفاصيل التوصيل.</p>
        </div>

        <form class="checkout-form" id="checkoutForm">
            <div class="form-group">
                <label for="customerName">الاسم الكامل *</label>
                <input type="text" id="customerName" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="customerAddress">العنوان التفصيلي *</label>
                <textarea id="customerAddress" class="form-control" rows="3" required></textarea>
            </div>

            <div class="form-group">
                <label for="customerPhone">رقم الهاتف *</label>
                <input type="tel" id="customerPhone" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="customerPhone2">رقم هاتف إضافي <span class="optional">(اختياري)</span></label>
                <input type="tel" id="customerPhone2" class="form-control">
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-submit">
                    <i class="fas fa-check"></i> تأكيد وإرسال الطلب
                </button>
                <button type="button" class="btn btn-back" id="backToCartBtn">
                    <i class="fas fa-arrow-right"></i> العودة إلى السلة
                </button>
            </div>
        </form>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>معرض كاضم البهادلي</h3>
                    <p>متخصصون في بيع اكسسوارات الموبايل، كفرات الأجهزة الكهربائية، وأجهزة العناية بالبشرة في ميسان.</p>
                </div>

                <div class="footer-section">
                    <h3>روابط سريعة</h3>
                    <ul>
                        <li><a href="#">الرئيسية</a></li>
                        <li><a href="#about">عن المعرض</a></li>
                        <li><a href="#" class="category-filter" data-category="موبايل">اكسسوارات الموبايل</a></li>
                        <li><a href="#" class="category-filter" data-category="أجهزة كهربائية">أجهزة كهربائية</a></li>
                        <li><a href="#" class="category-filter" data-category="عناية البشرة">عناية البشرة</a></li>
                        <li><a href="about.html">معلومات معرض كاضم البهادلي في ميسان</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>معلومات التواصل</h3>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> العراق، ميسان</li>
                        <li><i class="fas fa-clock"></i> أوقات الدوام: من 9 صباحاً إلى 9 مساءً</li>
                    </ul>
                </div>
            </div>

            <div class="copyright">
                <p>جميع الحقوق محفوظة &copy; 2023 معرض كاضم البهادلي في ميسان</p>
            </div>
        </div>
    </footer>

    <script type="module">
        // ==============================================
        // دالة تحويل روابط Google Drive
        // ==============================================
        function convertGoogleDriveLink(link, fileType = 'auto') {
            if (!link || typeof link !== 'string') return null;

            try {
                link = link.trim();

                // إذا لم يكن رابط Google Drive، إرجاعه كما هو
                if (!link.includes('drive.google.com') && !link.includes('docs.google.com') &&
                    !/^[a-zA-Z0-9_-]{25,}$/.test(link)) {
                    return link;
                }

                // استخراج FILE_ID
                let fileId = '';
                const patterns = [
                    /drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/,
                    /drive\.google\.com\/open\?id=([a-zA-Z0-9_-]+)/,
                    /drive\.google\.com\/uc\?id=([a-zA-Z0-9_-]+)/,
                    /docs\.google\.com\/uc\?id=([a-zA-Z0-9_-]+)/
                ];

                for (const pattern of patterns) {
                    const match = link.match(pattern);
                    if (match && match[1]) {
                        fileId = match[1];
                        break;
                    }
                }

                // إذا كان الرابط هو fileId مباشرة
                if (!fileId && /^[a-zA-Z0-9_-]{25,}$/.test(link)) {
                    fileId = link;
                }

                if (!fileId) return link;

                // تحديد نوع الملف
                if (fileType === 'auto') {
                    if (link.match(/\.(mp4|avi|mov|wmv|flv|mkv|webm)(\?|$)/i)) {
                        fileType = 'video';
                    } else {
                        fileType = 'image';
                    }
                }

                // إنشاء الرابط المناسب
                if (fileType === 'image') {
                    return `https://drive.google.com/thumbnail?id=${fileId}&sz=w1000`;
                } else if (fileType === 'video') {
                    return `https://drive.google.com/file/d/${fileId}/preview`;
                }

                return link;
            } catch (error) {
                console.error('Error converting Google Drive link:', error);
                return link;
            }
        }

        // ==============================================
        // استيراد Firebase
        // ==============================================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import {
            getFirestore,
            collection,
            addDoc,
            getDocs
        } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDrUah44UpE8q24hn5oh9YFzuYdM9KRYlA",
            authDomain: "kazm-8aecd.firebaseapp.com",
            projectId: "kazm-8aecd",
            storageBucket: "kazm-8aecd.firebasestorage.app",
            messagingSenderId: "657773627758",
            appId: "1:657773627758:web:2aa12ec7f637149c22197f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ==============================================
        // بيانات التطبيق
        // ==============================================
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let allProducts = [];
        let currentCategory = 'all';

        // ==============================================
        // عناصر DOM
        // ==============================================
        const productsGrid = document.getElementById('productsGrid');
        const cartCount = document.getElementById('cartCount');
        const cartLink = document.getElementById('cartLink');
        const cartPage = document.getElementById('cartPage');
        const checkoutPage = document.getElementById('checkoutPage');
        const cartItemsContainer = document.getElementById('cartItemsContainer');
        const subtotalElement = document.getElementById('subtotal');
        const totalElement = document.getElementById('total');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const backToCartBtn = document.getElementById('backToCartBtn');
        const checkoutForm = document.getElementById('checkoutForm');
        const successMessage = document.getElementById('successMessage');
        const productModal = document.getElementById('productModal');
        const closeModal = document.getElementById('closeModal');
        const modalProductTitle = document.getElementById('modalProductTitle');
        const productVideoContainer = document.getElementById('productVideoContainer');
        const productImages = document.getElementById('productImages');
        const productDescription = document.getElementById('productDescription');
        const modalProductPrice = document.getElementById('modalProductPrice');
        const modalAddToCart = document.getElementById('modalAddToCart');
        const categoryBtns = document.querySelectorAll('.category-btn');
        const categoryFilters = document.querySelectorAll('.category-filter');

        let currentProduct = null;

        // ==============================================
        // تهيئة المتجر
        // ==============================================
        function initStore() {
            loadProducts();
            updateCartCount();
            setupCategoryFilters();

            cartLink.addEventListener('click', (e) => {
                e.preventDefault();
                showCartPage();
            });

            backToCartBtn.addEventListener('click', showCartPage);
            checkoutBtn.addEventListener('click', showCheckoutPage);
            checkoutForm.addEventListener('submit', submitOrder);
            closeModal.addEventListener('click', () => {
                productModal.style.display = 'none';
            });

            window.addEventListener('click', (e) => {
                if (e.target === productModal) {
                    productModal.style.display = 'none';
                }
            });
        }

        // ==============================================
        // تحميل المنتجات
        // ==============================================
        async function loadProducts() {
            try {
                const querySnapshot = await getDocs(collection(db, "products"));
                allProducts = [];

                querySnapshot.forEach((doc) => {
                    const product = doc.data();
                    product.id = doc.id;
                    allProducts.push(product);
                });

                renderProducts();
            } catch (error) {
                console.error("Error loading products:", error);
                productsGrid.innerHTML = '<div class="empty-cart"><p>حدث خطأ في تحميل المنتجات</p></div>';
            }
        }

        // ==============================================
        // عرض المنتجات
        // ==============================================
        function renderProducts() {
            const filteredProducts = currentCategory === 'all'
                ? allProducts
                : allProducts.filter(p => p.category === currentCategory);

            productsGrid.innerHTML = '';

            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = `
                    <div style="grid-column:1/-1; text-align:center; padding:40px;">
                        <i class="fas fa-box-open" style="font-size:60px; color:#ccc; margin-bottom:20px;"></i>
                        <p>لا توجد منتجات في هذه الفئة</p>
                    </div>
                `;
                return;
            }

            filteredProducts.forEach(product => {
                const mainImage = product.images && product.images.length > 0
                    ? convertGoogleDriveLink(product.images[0], 'image') || product.images[0]
                    : 'https://via.placeholder.com/400x400?text=No+Image';

                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-image">
                        <img src="${mainImage}" alt="${product.title}" loading="lazy">
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${product.title}</h3>
                        <div class="product-price">${product.price || 0} دينار</div>
                        <div class="product-actions">
                            <button class="btn btn-preview" data-id="${product.id}">
                                <i class="fas fa-eye"></i> معاينة
                            </button>
                            <button class="btn btn-cart" data-id="${product.id}">
                                <i class="fas fa-cart-plus"></i> شراء
                            </button>
                        </div>
                    </div>
                `;

                productsGrid.appendChild(productCard);
            });

            document.querySelectorAll('.btn-preview').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const productId = e.target.closest('button').dataset.id;
                    showProductModal(productId);
                });
            });

            document.querySelectorAll('.btn-cart').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const productId = e.target.closest('button').dataset.id;
                    addToCart(productId);
                });
            });
        }

        // ==============================================
        // عرض تفاصيل المنتج
        // ==============================================
        function showProductModal(productId) {
            currentProduct = allProducts.find(p => p.id === productId);
            if (!currentProduct) return;

            modalProductTitle.textContent = currentProduct.title;
            productDescription.textContent = currentProduct.description || 'لا يوجد وصف';
            modalProductPrice.textContent = `${currentProduct.price || 0} دينار`;

            // عرض الفيديو
            productVideoContainer.innerHTML = '';
            if (currentProduct.videoUrl) {
                if (currentProduct.videoUrl.includes('drive.google.com')) {
                    const videoPreviewUrl = convertGoogleDriveLink(currentProduct.videoUrl, 'video');
                    productVideoContainer.innerHTML = `
                        <iframe src="${videoPreviewUrl}"
                                allow="autoplay; encrypted-media; fullscreen"
                                allowfullscreen>
                        </iframe>
                    `;
                } else {
                    productVideoContainer.innerHTML = `
                        <video controls>
                            <source src="${currentProduct.videoUrl}" type="video/mp4">
                            متصفحك لا يدعم تشغيل الفيديو
                        </video>
                    `;
                }
                productVideoContainer.style.display = 'block';
            } else {
                productVideoContainer.style.display = 'none';
            }

            // عرض الصور
            productImages.innerHTML = '';
            if (currentProduct.images && currentProduct.images.length > 0) {
                currentProduct.images.forEach((img, index) => {
                    const imageUrl = convertGoogleDriveLink(img, 'image') || img;
                    const imgElement = document.createElement('img');
                    imgElement.src = imageUrl;
                    imgElement.alt = `${currentProduct.title} - صورة ${index + 1}`;
                    imgElement.loading = 'lazy';

                    imgElement.addEventListener('click', () => {
                        productVideoContainer.innerHTML = `
                            <img src="${imageUrl}" style="width:100%; height:100%; object-fit:contain;" alt="${currentProduct.title}">
                        `;
                        productVideoContainer.style.display = 'block';
                    });

                    productImages.appendChild(imgElement);
                });
            } else {
                productImages.innerHTML = '<p style="text-align:center; color:var(--gray);">لا توجد صور</p>';
            }

            modalAddToCart.onclick = () => addToCart(currentProduct.id);
            productModal.style.display = 'block';
        }

        // ==============================================
        // إدارة السلة
        // ==============================================
        function addToCart(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            const existingItem = cart.find(item => item.id === productId);
            const imageUrl = product.images && product.images.length > 0
                ? convertGoogleDriveLink(product.images[0], 'image') || product.images[0]
                : '';

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: product.id,
                    title: product.title,
                    price: product.price || 0,
                    image: imageUrl,
                    quantity: 1
                });
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            alert(`تمت إضافة "${product.title}" إلى السلة`);

            if (productModal.style.display === 'block') {
                productModal.style.display = 'none';
            }
        }

        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
        }

        function setupCategoryFilters() {
            categoryBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    categoryBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = btn.dataset.category;
                    renderProducts();
                });
            });

            categoryFilters.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const category = link.dataset.category;
                    categoryBtns.forEach(b => b.classList.remove('active'));
                    const targetBtn = document.querySelector(`.category-btn[data-category="${category}"]`);
                    if (targetBtn) {
                        targetBtn.classList.add('active');
                    }
                    currentCategory = category;
                    renderProducts();
                });
            });
        }

        // ==============================================
        // إدارة الطلبات
        // ==============================================
        function showCartPage() {
            document.querySelector('section.container').style.display = 'none';
            cartPage.style.display = 'block';
            checkoutPage.style.display = 'none';
            successMessage.style.display = 'none';
            renderCartItems();
            updateCartSummary();
        }

        function renderCartItems() {
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>سلة المشتريات فارغة</h3>
                        <p>لم تقم بإضافة أي منتجات</p>
                        <button class="btn btn-cart" onclick="window.location.reload()">
                            <i class="fas fa-arrow-left"></i> العودة للمتجر
                        </button>
                    </div>
                `;
                return;
            }

            cartItemsContainer.innerHTML = '';
            cart.forEach((item, index) => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-image">
                        <img src="${item.image || 'https://via.placeholder.com/80x80?text=No+Image'}"
                             alt="${item.title}">
                    </div>
                    <div class="cart-item-details">
                        <h4 class="cart-item-title">${item.title}</h4>
                        <div class="cart-item-price">${item.price.toLocaleString()} دينار × ${item.quantity}</div>
                    </div>
                    <button class="remove-item" data-index="${index}">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                cartItemsContainer.appendChild(cartItem);
            });

            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.target.closest('button').dataset.index);
                    removeFromCart(index);
                });
            });
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCartItems();
            updateCartSummary();
            updateCartCount();
        }

        function updateCartSummary() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryFee = 2000;
            const total = subtotal + deliveryFee;

            subtotalElement.textContent = `${subtotal.toLocaleString()} دينار`;
            totalElement.textContent = `${total.toLocaleString()} دينار`;
        }

        function showCheckoutPage() {
            if (cart.length === 0) {
                alert('السلة فارغة');
                return;
            }

            cartPage.style.display = 'none';
            checkoutPage.style.display = 'block';
            successMessage.style.display = 'none';
            checkoutForm.reset();
        }

        async function submitOrder(e) {
            e.preventDefault();

            try {
                const orderData = {
                    name: document.getElementById('customerName').value,
                    address: document.getElementById('customerAddress').value,
                    phone: document.getElementById('customerPhone').value,
                    phone2: document.getElementById('customerPhone2').value || '',
                    cart: cart,
                    subtotal: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                    delivery: 2000,
                    total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0) + 2000,
                    date: new Date().toLocaleString('ar-IQ'),
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };

                await addDoc(collection(db, "orders"), orderData);

                checkoutForm.style.display = 'none';
                successMessage.style.display = 'block';

                cart = [];
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
                checkoutForm.reset();

            } catch (error) {
                console.error("Error submitting order:", error);
                alert('حدث خطأ أثناء إرسال الطلب');
            }
        }

        // ==============================================
        // بدء التطبيق
        // ==============================================
        document.addEventListener('DOMContentLoaded', initStore);
    </script>
</body>
</html>
